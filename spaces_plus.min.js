// ==UserScript==
// @name        	Spaces+
// @namespace   	https://github.com/crashmax-off/spaces_plus
// @description 	The script is designed to extend the functionality of Spaces.ru
// @author      	Creator: Maximoff, Updated: crashmax & molimawkа
// @include     	http://*.spaces.ru/*
// @include     	http://spaces.ru/*/*
// @include     	http://spaces.ru/*
// @include     	http://*.spaces.ru/*/*
// @include     	https://*.spaces.ru/*
// @include     	https://spaces.ru/*/*
// @include     	https://spaces.ru/*
// @include     	https://*.spaces.ru/*/*
// @match       	http://*.spaces.ru/*
// @match       	http://spaces.ru/*/*
// @match       	http://spaces.ru/*
// @match       	http://*.spaces.ru/*/*
// @match       	https://*.spaces.ru/*
// @match       	https://spaces.ru/*/*
// @match       	https://spaces.ru/*
// @match       	https://*.spaces.ru/*/*
// @version     	2.0
// @grant       	none
// ==/UserScript==

!function(){var e,t,n,s,i,a,l,r,o,c,p,d,u,_,m,f,g,h;e=document.location.protocol.toString(),t=null,n=null,s=null,i=null,a=0,l=0,r=0,o=0,c=0,p=-1,d=0,u=null,_="data:image/png;base64,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",m=new Object,f={comments:!1,comments_m2:!1,blogsd:!0,readersd:!0,favorite:!0,blocked:!1,rscroll:!1,hrightbar:!1,playerdn:!0,coins:!0,rurl:!1,fileTools:!0,gifts:!1,online:!0,myEvents:!0,friendsOn:!0,isOnline:!1,isOnlineInt:1,bodystyle:{url:"https://crashmax-off.github.io/bg/default.jpg",color:"#DAE1E8",urlchecked:!0,colorchecked:!1},events:{url:"https://crashmax-off.github.io/sn/default.ogg",volume:70,mail:!0,journal:!0,feed:!1,notifications:!1},friendsOnMax:10,friendsListSH:!0,hideNotyf:{cookieEditor:!1,isOnline:!1}},g={comments:"Пакетное удаление комментариев",blogsd:"Пакетное удаление блогов",readersd:"Пакетное удаление читателей",fileTools:"Дополнительные кнопки в блогах",friendsOn:"Панель друзей онлайн",myEvents:'Свой звук уведомлений <a href=\'#\' onclick=\'if(confirm("В настройках сайта должен быть выключен звук уведомлений. Файл должен быть в форматах *.ogg или *.mp3.\\nУказывайте прямую ссылку!\\n\\nХотите открыть каталог рингтонов?")) {window.open("https://crashmax-off.github.io/sn/", "_blank");} return false;\' style=\'cursor: help;\'><span class="ico" style="background-position: -234px -144px;"></span></a>',online:"Точное время онлайн в анкетах",favorite:"Возможность добавить пользователя в закладки",playerdn:"Кнопка загрузки трека из плеера",rscroll:"Скроллер страницы справа",hrightbar:"Скрыть правое меню",blocked:"Открытые разделы удаленных пользователей",coins:"Собирать бонусные монеты",rurl:"Автоматический редирект внешних ссылок",bodystyle:"Задать фон сайта",gifts:"Предпросмотр подарков"},(h={ajax:function(e,t,n,s,i){i=void 0!==i?i:4;var a=new XMLHttpRequest;a.open(t,e,!0),"POST"==t?(a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(n)):a.send(null),a.onreadystatechange=function(){if(a.readyState==i){if(200!=a.status)return!1;s&&s(a.responseText)}}},jajax:function(e,t){e=e.replace(/\#.*$/i,"")+(e.indexOf("?")>=1?"&json=1":"?json=1");var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("X-Proxy","spaces"),n.send(null),n.onreadystatechange=function(){return 4!=n.readyState?null:200!=n.status?null:void(t&&t(n.responseText))}},getQuery:function(e){var t=document.location.search,n=null;try{return e=e.toLowerCase(),t.toLowerCase().indexOf(e)>=1&&t.substring(1).split("&").forEach(function(t){var s=t.split("=");s[0].toLowerCase()==e&&(n=s[1])}),n}catch(e){return h.console.error("Ошибка (GETQUERY): "+e.name+":"+e.message+"\n"+e.stack),null}},css:function(e,t){var n=t.split(";");for(var s in n)if(""!=h.trim(n[s])){var i=h.trim(n[s]).split(":");i[0].indexOf("-")>=0&&(i[0]=i[0].replace(/\-([a-z]{1})/g,function(e,t){return t.toUpperCase()})),void 0!==i[1]&&(e.style[h.trim(i[0])]=h.trim(i[1]))}},htmlspecialchars:function(e){return"string"==typeof e&&(e=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace("\n","br/>")),e},ce:function(e,t){var n=document.createElement(e);if(t)for(var s in t)if("style"==s)h.css(n,t[s]);else if("attr"==s)for(var i in t[s])n.setAttribute(i,t[s][i]);else"html"==s?n.innerHTML=t[s]:"class"==s?n.className=t[s]:n[s]=t[s];return n},readSettings:function(){var e=h.getCookie("SP_PLUS_SET");try{e&&(e=JSON.parse(e),f=h.extend(f,e))}catch(e){h.console.error("Ошибка (READSETTINGS): "+e.name+":"+e.message+"\n"+e.stack)}},newbequest:function(){var t=h.qs("#sp_newbequest_togl");t&&h.jajax(e+"//spaces.ru/mysite/",function(e){try{e&&(h.extend({owner_widget:{newbee_quest_widget:null}},JSON.parse(e)).owner_widget.newbee_quest_widget?t.style.display="":t.style.display="none")}catch(e){h.console.error("Ошибка (NEWBEE_JSON): "+e.name+":"+e.message+"\n"+e.stack)}})},settings:function(){var t=document.location.pathname.toString(),n=document.location.href.toString();if("/settings/"==t&&!h.qs("#SP_PLUS_SETLINK"))try{var s=h.find(document.links,{href:e+"//spaces.ru/settings/password/?"});if(s){s=s[0];var i=h.getQuery("sp_plus_settings"),l=h.getQuery("sp_cookie_editor"),r=h.getQuery("sp_isonline_editor"),o=h.ce("a",{href:e+"//spaces.ru/settings/?sp_plus_settings=1",id:"SP_PLUS_SETLINK",class:s.className,html:'<span>Настройки Spaces+</span><span class="ico ico_arr ico_m"></span>',onclick:function(t){var s=h.qs("#SP_PLUS_SETLINK").parentNode.parentNode.parentNode.parentNode,o=20..toString().split("").join(".");if("main"==s.id){var c=h.qs("#header_path");c&&(c.innerHTML=c.innerHTML.replace("Настройки",'<span id="SP_PLUS_SETHEAD2">Spaces+</span>')),s.innerHTML='<div class="widgets-group widgets-group_top js-container__block"><div class="b-title cl b-title_center b-title_first oh"><div class="b-title__item">Настройки Spaces+ <sup>'+o+'</sup><span class="js-cnt cnt cnt_title hide"></span></div></div><div class="content"><div class="list f-c_fll"> <div id="SP_PLUS_SETAREA" class="list_item lh_160"></div></div></div></div> <a id="SP_PLUS_SETBACK" href="http://spaces.ru/settings/?" class="link-return full_link"><span class="ico ico_arrow-back"></span><span class="m">Назад</span></a>'}else"main"==s.className?s.innerHTML=s.firstElementChild.outerHTML.replace("Настройки",'Настройки <span style="color: #0000FF;">Spaces+</span>')+'<div class="start_page_padd light_blue_bg"><b id="SP_PLUS_SETHEAD">Настройки <span style="color: #0000FF;">Spaces+ '+o+'</span></b></div><div id="SP_PLUS_SETAREA"></div><a id="SP_PLUS_SETBACK" href="http://spaces.ru/settings/?" class="link-return full_link"><span class="ico ico_arrow-back"></span><span class="m">Назад</span></a>':h.alertmenu("<h4>Настройки <span>Spaces+ <sup>"+o+'</sup></span></h4><div id="SP_PLUS_SETAREA" style="text-align:left!important;line-height:1.5;display:block;height:100%;"></div>',1,1);var p=h.qs("#SP_PLUS_SETAREA");if(p){for(var d in f){if("bodystyle"==d){var u=h.ce("div",{style:"padding-left: 7px; margin-left: 7px; border-left: 5px solid #92BEE2;"}),_=h.ce("input",{type:"text",value:f.bodystyle.url,class:"text-input",style:"width: 40%;",placeholder:"URL изображения"});_.onchange=_.oninput=function(e){if(h.isValidUrl(e.target.value)||""==e.target.value){e.target.style.backgroundColor="",f.bodystyle.url=h.trim(e.target.value);var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null),h.setStyle()}else e.target.style.backgroundColor="#FF7C7C"};var m=h.ce("input",{type:"color",value:f.bodystyle.color,placeholder:"Цвет фона"});m.onchange=m.oninput=function(e){if(/^\#([A-Za-z0-9]{3}|[A-Za-z0-9]{6})$/i.test(e.target.value)||""==e.target.value){e.target.style.backgroundColor="",f.bodystyle.color=h.trim(e.target.value);var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null),h.setStyle()}else e.target.style.backgroundColor="#FF7C7C"};var v=h.ce("input",{type:"checkbox",id:"sp_set_"+d+"_URL",checked:f.bodystyle.urlchecked,class:"sp_plus_checkbox_el",onclick:function(e){f.bodystyle.urlchecked=e.target.checked,e.target.checked&&S.checked&&(S.checked=!1,f.bodystyle.colorchecked=!1);var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null),h.setStyle()}}),S=h.ce("input",{type:"checkbox",id:"sp_set_"+d+"_color",checked:f.bodystyle.colorchecked,class:"sp_plus_checkbox_el",onclick:function(e){f.bodystyle.colorchecked=e.target.checked,e.target.checked&&v.checked&&(v.checked=!1,f.bodystyle.urlchecked=!1);var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null),h.setStyle()}}),b=h.ce("span",{html:"Фон сайта"}),y=h.ce("span",{html:" - URL"}),k=h.ce("span",{html:" - Цвет"}),x=h.ce("label",{attr:{for:"sp_set_"+d+"_URL"}}),C=h.ce("label",{attr:{for:"sp_set_"+d+"_color"}});p.appendChild(b),u.appendChild(v),u.appendChild(x),x.appendChild(_),x.appendChild(y),u.appendChild(h.ce("br",null)),u.appendChild(S),u.appendChild(C),C.appendChild(m),C.appendChild(k),p.appendChild(u),p.appendChild(h.ce("br",null))}else if(void 0!==g[d])var L=h.ce("input",{id:"sp_set_"+d,type:"checkbox",class:"sp_plus_checkbox_el",checked:f[d],onclick:function(e){var t=e.target.id.split("_")[2];f[t]=e.target.checked;var n=JSON.stringify(f);if(h.setCookie("SP_PLUS_SET",n,null),"sp_set_rscroll"==e.target.id)h.scrollMove(e.target.checked);else if("sp_set_hrightbar"==e.target.id)h.hiddenRightbar(e.target.checked);else if("sp_set_debug"==e.target.id)e.target.checked?h.console.debug("[S+] Запустили консоль!"):h.console.remove();else if("sp_set_myEvents"==e.target.id)if(e.target.checked)h.evenstSupport(e.target);else{a=0;var s=h.qs("#SP_PLUS_EVENTS");s&&h.remove(s)}else if("sp_set_friendsOn"==e.target.id)if(h.friendsOnline(e.target.checked),e.target.checked)h.setFriend(e.target);else{var i=h.qs("#SP_PLUS_MAXFRIENDS");i&&h.remove(i)}else if("sp_set_comments"==e.target.id)if(e.target.checked)h.comments2m(e.target);else{var l=h.qs("#SP_C2M_WRAP");l&&h.remove(l)}}}),N=h.ce("label",{html:g[d],attr:{for:"sp_set_"+d}});void 0!==g[d]&&(p.appendChild(L),p.appendChild(N),p.appendChild(h.ce("br",null)))}f.friendsOn&&h.setFriend(h.qs("#sp_set_friendsOn")),f.comments&&h.comments2m(h.qs("#sp_set_comments")),f.myEvents&&h.evenstSupport(h.qs("#sp_set_myEvents"));var E=h.ce("span",{html:"Встроенные возможности сайта"});p.appendChild(E),h.spacesAction(p),p.appendChild(h.ce("br",null));var P=h.ce("a",{href:e+"//spaces.ru/newbequest/?r=newbequest/delete",style:"display: none",id:"sp_newbequest_togl",class:"sp_plus_a",html:"Скрыть квест новичка",onclick:function(t){var n=h.getCK(0);return h.confirmm("Хотите удалить квест новичка?",function(){h.ajax(e+"//spaces.ru/newbequest/delete/?CK="+n+"&link_id=0","GET",null,function(){h.alertm("Квест новичка скрыт!",1,null)},2),setTimeout(function(){h.newbequest()},1e3)}),!1}});p.appendChild(P),h.newbequest(),p.appendChild(h.ce("br",null));var T=h.ce("a",{href:("http:"==e?"https:":"http:")+"//spaces.ru/settings/?sp_plus_settings=1",class:"sp_plus_a",id:"sp_protocol_togl",html:"Переключиться на "+("http:"==e?"HTTPS":"HTTP")+"-протокол",onclick:function(){return document.location.href=("http:"==e?"https:":"http:")+"//spaces.ru/settings/?sp_plus_settings=1",!1}});p.appendChild(T),p.appendChild(h.ce("br",null));var w=h.ce("a",{href:e+"//spaces.ru/settings/?sp_plus_settings=1&sp_cookie_editor=1",class:"sp_plus_a",id:"sp_cookie_editor",html:"Редактор Cookies",onclick:function(){var t=h.qs("#SP_PLUS_SETHEAD"),s=h.qs("#SP_PLUS_SETHEAD2"),a=h.qs("#SP_PLUS_SETBACK");return t&&(t.innerHTML='<a href="http://spaces.ru/settings/?sp_plus_settings=1">Spaces+</a><span class="location-bar__sep ico"></span> Редактор cookies'),s&&(s.innerHTML='<a href="http://spaces.ru/settings/?sp_plus_settings=1">Spaces+</a><span class="location-bar__sep ico"></span> Редактор cookies'),a&&(a.href=e+"//spaces.ru/settings/?sp_plus_settings=1"),/(\?|&)sp_cookie_editor=1/i.test(n)||h.historyPush({sp_plus_settings:i,sp_cookie_editor:l},e+"//spaces.ru/settings/?sp_plus_settings=1&sp_cookie_editor=1","Spaces+: Редактор Cookies"),h.cookieEditor("#SP_PLUS_SETAREA"),!1}});p.appendChild(w);var O=h.ce("a",{href:e+"//spaces.ru/settings/?sp_plus_settings=1&sp_isonline_editor=1",class:"sp_plus_a",id:"sp_isonline_editor",html:"Проверка онлайна",onclick:function(){if("Notification"in window)if("granted"===Notification.permission.toLowerCase()){var t=h.qs("#SP_PLUS_SETHEAD"),s=h.qs("#SP_PLUS_SETHEAD2"),a=h.qs("#SP_PLUS_SETBACK");t&&(t.innerHTML='<span style="color: #0000FF;">Spaces+</span>: проверка онлайна'),s&&(s.innerHTML='<a href="http://spaces.ru/settings/?sp_plus_settings=1">Spaces+</a><span class="location-bar__sep ico"></span> Проверка онлайна'),a&&(a.href=e+"//spaces.ru/settings/?sp_plus_settings=1"),/(\?|&)sp_isonline_editor=1/i.test(n)||h.historyPush({sp_plus_settings:i,sp_isonline_editor:r},e+"//spaces.ru/settings/?sp_plus_settings=1&sp_isonline_editor=1","Spaces+: проверка онлайна"),h.isOnlineSetting("#SP_PLUS_SETAREA")}else"denied"!==Notification.permission.toLowerCase()?Notification.requestPermission(function(t){if("granted"===t.toLowerCase()){var s=h.qs("#SP_PLUS_SETHEAD"),a=h.qs("#SP_PLUS_SETHEAD2"),l=h.qs("#SP_PLUS_SETBACK");s&&(s.innerHTML='<span style="color: #0000FF;">Spaces+</span>: проверка онлайна'),a&&(a.innerHTML='<span style="color: #0000FF;">Spaces+</span>: проверка онлайна'),l&&(l.href=e+"//spaces.ru/settings/?sp_plus_settings=1"),/(\?|&)sp_isonline_editor=1/i.test(n)||h.historyPush({sp_plus_settings:i,sp_isonline_editor:r},e+"//spaces.ru/settings/?sp_plus_settings=1&sp_isonline_editor=1","Spaces+: проверка онлайна"),h.isOnlineSetting("#SP_PLUS_SETAREA")}else h.alertm("Разрешите браузеру показывать уведомления с сайта Spaces.ru, чтобы пользоваться функцией!",1,null)}):h.alertm("Вы <b style='color: #800;'>запретили</b> показывать уведомления для сайта Spaces.ru!<br/>Зайдите в настройки браузера и настройте доступ.",1,null);else h.alertm("Ваш браузер не поддерживает уведомления!",1,null);return!1}});p.appendChild(h.ce("br",null)),p.appendChild(O);var A=h.ce("a",{href:"#",class:"sp_plus_a",id:"sp_plus_reset",style:"font-weight: bold; color: #903030",html:"Сброс настроек",onclick:function(){return h.confirmm("Сбросить <b style='color: #F00;'>ВСЕ</b> настройки скрипта?",function(){h.delCookie("SP_PLUS_SET"),document.location.reload()}),!1}});p.appendChild(h.ce("br",null)),p.appendChild(A),/(\?|&)sp_plus_settings=1/i.test(n)||h.historyPush({sp_plus_settings:i},e+"//spaces.ru/settings/?sp_plus_settings=1","Настройки Spaces+")}return!1}});if(h.inBefore(o,s),"BR"==s.nextElementSibling.nodeName&&h.insertAfter(h.ce("br",null),o),i){document.title="Настройки Spaces+";var c=document.createEvent("MouseEvent");if(c.initEvent("click",!0,!0),o.dispatchEvent(c),/#([da-z0-9\_]+)$/i.test(n)){var p=/#([da-z0-9\_]+)$/i.exec(n)[0],d=h.qs(p);d&&("#sp_protocol_togl"==p||"#sp_plus_reset"==p||"#sp_cookie_editor"==p||"#wrap_spaces_option"==p?d.style.backgroundColor="#FFC107":d.nextElementSibling.style.backgroundColor="#FFC107",setTimeout(function(){window.scrollTo(0,d.offsetTop)},100))}else if(l)document.title="Spaces+: Редактор Cookies",(u=document.createEvent("MouseEvent")).initEvent("click",!0,!0),h.qs("#sp_cookie_editor").dispatchEvent(u);else if(r){var u;document.title="Spaces+: проверка онлайна",(u=document.createEvent("MouseEvent")).initEvent("click",!0,!0),h.qs("#sp_isonline_editor").dispatchEvent(u)}}}}catch(e){h.console.error("Ошибка (SETTINGS): "+e.name+":"+e.message+"\n"+e.stack)}},notifications:function(e,t,n){try{"Notification"in window?"granted"===Notification.permission.toLowerCase()?h.notificationShow(e,t,n):"denied"!==Notification.permission.toLowerCase()?Notification.requestPermission(function(s){"granted"===s.toLowerCase()?h.notificationShow(e,t,n):h.alertm("Вы <b style='color: #800;'>запретили</b> показывать уведомления для сайта Spaces.ru!<br/>Зайдите в настройки браузера и настройте доступ.",1,null)}):h.alertm("Разрешите браузеру показывать уведомления с сайта Spaces.ru, чтобы пользоваться функцией!",1,null):h.alertm("Ваш браузер не поддерживает уведомления!",1,null)}catch(e){h.console.error("Ошибка (NOTIFICATIONS): "+e.name+":"+e.message+"\n"+e.stack)}},notificationShow:function(e,t,n){try{var s=new Notification(e,t);null!=n&&(s.onclick=function(e){e.preventDefault(),h.setLocation(n),e.target.close()})}catch(e){h.console.error("Ошибка (NOTIFICATION_SHOW): "+e.name+":"+e.message+"\n"+e.stack)}},isOnlineSupport:function(e){try{u&&e&&(clearInterval(u),u=null),!u&&f.isOnline&&(e||h.isOnline(m),u=setInterval(function(){h.isOnline(m)},6e4*f.isOnlineInt))}catch(e){h.console.error("Ошибка (ISONLINE_SUPPORT): "+e.name+":"+e.message+"\n"+e.stack)}},isOnline:function(t){try{var n=new Array;for(var s in t)n.push(s);var i=n.length;if(i>0)var a=setInterval(function(){i--,h.jajax(e+"//spaces.ru/anketa/?user="+n[i],function(n){if(n)try{var s=h.extend({user_widget:{is_online:null,name:null,photo_widget:{previewURL:null}}},JSON.parse(n));if(s.user_widget.name){var i=s.user_widget.name;if(h.console.info("Проверка онлайна: "+i),"1"==s.user_widget.is_online&&t[i]&&"off"==t[i]){var a;a=s.user_widget.photo_widget.previewURL&&/\.p\.\d+\.\d+\.\d+.*?jpg\?\d+$/i.test(s.user_widget.photo_widget.previewURL)?s.user_widget.photo_widget.previewURL.replace(/\.p\.\d+\.\d+\.(\d+)(.*?)jpg\?(\d+)$/i,".p.40.40.$1$2jpg?$3"):_,h.notifications(s.user_widget.name+" онлайн!",{body:"Пользователь "+s.user_widget.name+" появился в сети!",icon:a,tag:s.user_widget.name},e+"//spaces.ru/mysite/?name="+s.user_widget.name),m[s.user_widget.name]="on";var l=JSON.stringify(m);h.setCookie("SP_PLUS_ONLINE",l,null)}else 0==s.user_widget.is_online&&t[i]&&"on"==t[i]&&(m[s.user_widget.name]="off",l=JSON.stringify(m),h.setCookie("SP_PLUS_ONLINE",l,null))}}catch(e){h.console.error("Ошибка (JSON_ISONLINE): "+e.name+":"+e.message+"\n"+e.stack)}}),i<1&&clearInterval(a)},1e3)}catch(e){h.console.error("Ошибка (ISONLINE): "+e.name+":"+e.message+"\n"+e.stack)}},isOnlineSetting:function(t){window.scrollTo(0,0);var n=h.qs(t);if(n)try{if(n.innerHTML="",!f.hideNotyf.isOnline){var s=h.ce("img",{class:"p16 m pointer right",style:"padding: 10px;",src:e+"//spac.me/i/remove.png",title:"Понятно, больше не показывать.",onclick:function(e){f.hideNotyf.isOnline=!0;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null),h.isOnlineSetting("#SP_PLUS_SETAREA")}}),i=h.ce("div",{class:"stnd-block-yellow",style:"padding: 15px;",html:'Вы можете добавить здесь аккаунты, о онлайне которых нужно оповещать, а также частоту проверки.<br /><span class="ico ico_alert"></span><b style="color: #F00;">Внимание!</b> <b>Функция потребляет трафик в фоновом режиме!</b>'}),a=h.ce("div",{class:"none"});a.appendChild(s),n.appendChild(a),a.appendChild(i),n.appendChild(h.ce("br",null))}var l=h.ce("div",{class:"content-bl__sep",style:"padding: 10px; margin: -10px;",html:'<label class="label" style="margin-top: -7px;margin-bottom: 2px; text-align: left;">Настройки:</label>'}),r=h.ce("input",{id:"sp_set_isOnline",type:"checkbox",class:"sp_plus_checkbox_el",checked:f.isOnline,onclick:function(e){f.isOnline=e.target.checked;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null),h.isOnlineSupport(1)}}),o=h.ce("label",{html:" - включить функцию",attr:{for:"sp_set_isOnline"}}),c=h.declOfNum(h.isInteger(f.isOnlineInt)?f.isOnlineInt:3,["минута.","минуты.","минут."]),p=h.ce("span",{style:"color: #808080; margin-left: 7px; font-size: small",html:"Интервал проверки: "+f.isOnlineInt+" "+c}),d=h.ce("input",{type:"range",min:1,max:60,step:1,value:f.isOnlineInt});d.onchange=d.oninput=function(e){if(!isNaN(e.target.value)){var t=parseInt(e.target.value,10);(t<1||t>60)&&(t=1);var n=h.declOfNum(h.isInteger(t/2)?t/2:3,["минута.","минуты.","минут."]);p.innerHTML="Интервал проверки: "+(t/2).toFixed(1)+" "+n,f.isOnlineInt=t/2;var s=JSON.stringify(f);h.setCookie("SP_PLUS_SET",s,null),h.isOnlineSupport(1)}};var u=1,g=h.ce("a",{class:"sp_plus_a",html:"Тест уведомления",href:"#",onclick:function(e){return h.notifications("Тестовое уведомление #"+u+"!",{body:"Текст уведомления #"+u+".",icon:_,tag:"test"},null),u++,!1}});l.appendChild(r),l.appendChild(o),l.appendChild(h.ce("br",null)),l.appendChild(d),l.appendChild(h.ce("br",null)),l.appendChild(p),l.appendChild(h.ce("br",null)),l.appendChild(g),n.appendChild(l);var v=h.ce("div",{class:"content-bl__sep",style:"padding: 10px; margin: -10px;",html:'<label class="label" style="margin-top: 7px; margin-bottom: 2px; text-align: left;">Добавить пользователя:</label>'}),S=h.ce("input",{type:"text",class:"text-input",placeholder:"Ник пользователя",style:"width: 60%; margin: 3px;"});S.onchange=S.oninput=function(e){/^[A-Za-z0-9\_]+$/i.test(e.target.value)||""==h.trim(e.target.value)?e.target.style.backgroundColor="":e.target.style.backgroundColor="#FF7C7C"};var b=h.ce("button",{html:"<span class='sp_plus_ico_okb'></span> Добавить",style:"max-width: 30%; margin: 3px; padding: 5px 3px 3px 7px; font-size: 14px;",onclick:function(e){var t="SPAN"==e.target.nodeName?e.target.parentNode.previousElementSibling:e.target.previousElementSibling,n=h.htmlspecialchars(h.trim(t.value));/^[A-Za-z0-9\_]+$/i.test(n)&&""!=h.trim(n)?m[n]?h.alertm("Пользователь <span style='color: #0000FF;'>\""+n+'"</span> уже есть в списке!',1,null):""!=n?h.confirmm("Хотите добавить пользователя <span style='color: #0000FF;'>\""+n+'"</span> в список?',function(){m[n]="off";var e=JSON.stringify(m);h.setCookie("SP_PLUS_ONLINE",e,null),h.isOnlineSetting("#SP_PLUS_SETAREA")}):h.alertm("Задайте ник пользователя!",1,null):h.alertm("Ник пользователя должен состоять из латинских букв, цифр и символа подчёркивания!",1,null)}});for(var y in v.appendChild(S),v.appendChild(b),n.appendChild(v),n.appendChild(h.ce("div",{html:'<label class="label" style="margin-top: 15px; margin-bottom: 2px; text-align: left;">Список пользователей:</label>'})),m){var k=h.ce("div",null),x=h.ce("a",{href:e+"//spaces.ru/mysite/?name="+y,class:"sp_plus_a",html:y,style:"margin-right: 12px;"}),C=h.ce("a",{html:"<span class='sp_plus_ico_del'></span>",title:"Удалить",href:"#",onclick:function(e){var t="SPAN"==e.target.nodeName?e.target.parentNode.previousElementSibling:e.target.previousElementSibling,n=h.htmlspecialchars(h.trim(t.innerHTML));return m[n]?""!=n?h.confirmm("Хотите удалить пользователя <span style='color: #0000FF;'>\""+n+'"</span> из списка?',function(){delete m[n];var e=JSON.stringify(m);h.setCookie("SP_PLUS_ONLINE",e,null),h.isOnlineSetting("#SP_PLUS_SETAREA")}):h.alertm("Ошибка удаления!",1,null):h.alertm("Пользователя <span style='color: #0000FF;'>\""+n+'"</span> нет в списке!',1,null),!1}});k.appendChild(x),k.appendChild(C),n.appendChild(k)}}catch(e){h.console.error("Ошибка (ISONLINE_SETTINGS): "+e.name+":"+e.message+"\n"+e.stack)}},comments2m:function(e){try{var t=h.ce("div",{id:"SP_C2M_WRAP",style:"padding-left: 7px; margin-left: 7px; border-left: 5px solid #92BEE2;"}),n=h.ce("input",{type:"checkbox",id:"sp_comments_m2",class:"sp_plus_checkbox_el",checked:f.comments_m2,onclick:function(e){f.comments_m2=e.target.checked;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null)}}),s=h.ce("label",{attr:{for:"sp_comments_m2"},html:" - альтернативный метод (если не работает основной)",style:"font-size: small;"});t.appendChild(n),t.appendChild(s),h.insertAfter(t,e.nextElementSibling.nextElementSibling)}catch(e){h.console.error("Ошибка (C2M_SUPPORT): "+e.name+":"+e.message+"\n"+e.stack)}},setFriend:function(e){try{var t=h.ce("div",{id:"SP_PLUS_MAXFRIENDS",style:"padding-left: 7px; margin-left: 7px; border-left: 5px solid #92BEE2;"}),n=h.ce("input",{type:"number",class:"text-input",min:1,max:15,step:1,size:3,placeholder:"1 - 15",value:f.friendsOnMax});n.onchange=n.oninput=function(e){if(!isNaN(e.target.value)){var t=parseInt(e.target.value,10);(t>15||t<1)&&(t=10),l=0,f.friendsOnMax=t;var n=JSON.stringify(f);h.setCookie("SP_PLUS_SET",n,null),h.friendsOnline(1)}};var s=h.ce("span",{html:" - максимум друзей (1 - 15).",style:"color: #808080; font-size: small;"}),i=h.ce("input",{type:"checkbox",id:"sp_friends_list_sh",class:"sp_plus_checkbox_el",checked:f.friendsListSH,onclick:function(e){f.friendsListSH=e.target.checked;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null)}}),a=h.ce("label",{attr:{for:"sp_friends_list_sh"},html:" - скрывать/показывать по клику на счётчике.",style:"font-size: small;"});t.appendChild(n),t.appendChild(s),t.appendChild(h.ce("br",null)),t.appendChild(i),t.appendChild(a),h.insertAfter(t,e.nextElementSibling.nextElementSibling)}catch(e){h.console.error("Ошибка (FRIENDS_MAX_SUPPORT): "+e.name+":"+e.message+"\n"+e.stack)}},evenstSupport:function(e){try{var t=h.ce("div",{id:"SP_PLUS_EVENTS",style:"padding-left: 7px; margin-left: 7px; border-left: 5px solid #92BEE2;"}),n=h.ce("input",{type:"checkbox",id:"sp_event_notif",class:"sp_plus_checkbox_el",checked:f.events.notifications,onclick:function(e){if(!("Notification"in window))return h.alertm("Ваш браузер не поддерживает уведомления!",1,null),!1;if("granted"===Notification.permission.toLowerCase()){f.events.notifications=e.target.checked;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null)}else{if("denied"===Notification.permission.toLowerCase())return h.alertm("Вы <b style='color: #800;'>запретили</b> показывать уведомления для сайта Spaces.ru!<br/>Зайдите в настройки браузера и настройте доступ.",1,null),!1;Notification.requestPermission(function(t){if("granted"!==t.toLowerCase())return h.alertm("Разрешите браузеру показывать уведомления с сайта Spaces.ru, чтобы пользоваться функцией!",1,null),!1;f.events.notifications=e.target.checked;var n=JSON.stringify(f);h.setCookie("SP_PLUS_SET",n,null)})}}}),s=h.ce("label",{attr:{for:"sp_event_notif"},html:" - уведомления в браузере.",style:"font-size: small;"}),i=h.ce("input",{type:"url",value:f.events.url,class:"text-input",style:"width: 40%",placeholder:"https://example.com/sound.ogg"});i.onchange=i.oninput=function(e){if(h.isValidUrl(e.target.value)&&/\.(ogg|mp3)$/i.test(e.target.value)||""==h.trim(e.target.value)){f.events.url=h.trim(e.target.value);var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null)}else e.target.style.backgroundColor="#FF7C7C"};var a=h.ce("a",{href:"#",html:'<span class="ico ico_play"></span>',style:"margin-left: 7px; font-size: small",title:"Прослушать",onclick:function(e){return h.sound(f.events.url+"?r="+h.rand(1e3,9999),f.events.volume),!1}}),l=h.ce("span",{style:"color: #808080; margin-left: 7px; font-size: small",html:f.events.volume+"%"}),r=h.ce("input",{type:"range",min:0,max:100,step:1,value:f.events.volume});r.onchange=r.oninput=function(e){if(!isNaN(e.target.value)){var t=parseInt(e.target.value,10);(t<0||t>100)&&(t=70),l.innerHTML=t+"%",f.events.volume=t;var n=JSON.stringify(f);h.setCookie("SP_PLUS_SET",n,null)}};var o=h.ce("input",{type:"checkbox",id:"sp_event_mail",class:"sp_plus_checkbox_el",checked:f.events.mail,onclick:function(e){f.events.mail=e.target.checked;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null)}}),c=h.ce("label",{attr:{for:"sp_event_mail"},html:" - уведомлять о почте.",style:"font-size: small;"}),p=h.ce("input",{type:"checkbox",id:"sp_event_journal",class:"sp_plus_checkbox_el",checked:f.events.journal,onclick:function(e){f.events.journal=e.target.checked;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null)}}),d=h.ce("label",{attr:{for:"sp_event_journal"},html:" - уведомлять о журнале.",style:"font-size: small;"}),u=h.ce("input",{type:"checkbox",id:"sp_event_feed",class:"sp_plus_checkbox_el",checked:f.events.feed,onclick:function(e){f.events.feed=e.target.checked;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null)}}),_=h.ce("label",{attr:{for:"sp_event_feed"},html:" - уведомлять о ленте.",style:"font-size: small;"});t.appendChild(n),t.appendChild(s),t.appendChild(h.ce("br",null)),t.appendChild(i),t.appendChild(a),t.appendChild(h.ce("br",null)),t.appendChild(r),t.appendChild(l),t.appendChild(h.ce("br",null)),t.appendChild(o),t.appendChild(c),t.appendChild(h.ce("br",null)),t.appendChild(p),t.appendChild(d),t.appendChild(h.ce("br",null)),t.appendChild(u),t.appendChild(_),t.appendChild(h.ce("br",null)),h.insertAfter(t,e.nextElementSibling.nextElementSibling)}catch(e){h.console.error("Ошибка (EVENTS_SUP): "+e.name+":"+e.message+"\n"+e.stack)}},historyPush:function(e,t,n){try{document.title=n,history.pushState(e,n,t)}catch(e){h.console.error("Ошибка (HISTORY): "+e.name+":"+e.message+"\n"+e.stack)}},remove:function(e){return e.parentNode.removeChild(e)},isInteger:function(e){return(0^e)===e},wrap:function(e,t){return t=t||h.ce("div",null),e.nextSibling?h.inBefore(t,e.nextSibling):e.parentNode.appendChild(t),t.appendChild(e)},is_array:function(e){return e instanceof Array},scrollMove:function(e){try{var t=h.qs("#scroll_page");t&&!t.hasAttribute("sp-replace")&&e?(t.style.left="auto",t.style.right="0",t.setAttribute("sp-replace","1")):!f.rscroll&&t&&t.hasAttribute("sp-replace")&&!e&&(t.style.left="0",t.style.right="auto",t.removeAttribute("sp-replace"))}catch(e){h.console.error("Ошибка (SCROLLER): "+e.name+":"+e.message+"\n"+e.stack)}},hiddenRightbar:function(e){try{var t=h.qs("#page_rightbar");t&&!t.hasAttribute("sp-hidden-rightbar")&&e?(t.style.display="none",t.setAttribute("sp-hidden-rightbar","1")):!f.hrightbar&&t&&t.hasAttribute("sp-hidden-rightbar")&&!e&&(t.style.display="block",t.removeAttribute("sp-hidden-rightbar"))}catch(e){h.console.error("Ошибка (HRIGHTBAT): "+e.name+":"+e.message+"\n"+e.stack)}},cookieEditor:function(t){window.scrollTo(0,0);var n=h.allCookie(),s=h.qs(t);if(s)try{if(s.innerHTML="",!f.hideNotyf.cookieEditor){var i=h.ce("img",{class:"p16 m pointer right",style:"padding: 10px;",src:e+"//spac.me/i/remove.png",title:"Понятно, больше не показывать.",onclick:function(e){f.hideNotyf.cookieEditor=!0;var t=JSON.stringify(f);h.setCookie("SP_PLUS_SET",t,null),h.cookieEditor("#SP_PLUS_SETAREA")}}),a=h.ce("div",{class:"stnd-block-yellow",style:"padding: 15px;",html:'<span class="ico ico_alert"></span>Никому не сообщайте значения ваших cookies! Не делайте скриншот этой страницы, на котором будут видны эти значения! От этого зависит безопасность вашего аккаунта!'}),l=h.ce("div",{class:"none"});l.appendChild(i),s.appendChild(l),l.appendChild(a),s.appendChild(h.ce("br",null))}var r=h.ce("div",{html:'<label class="label" style="margin-top: -7px;margin-bottom: 2px; text-align: left;">Создание новой cookies:</label>',class:"content-bl__sep",style:"padding: 10px; margin: -10px; text-align: center;"}),o=h.ce("input",{type:"text",class:"text-input",placeholder:"Имя",style:"width: 30%; margin: 3px;"}),c=h.ce("input",{type:"text",class:"text-input",placeholder:"Значение",style:"width: 30%; margin: 3px;"}),p=h.ce("button",{html:'<span class="sp_plus_ico_okb"></span> Добавить',style:"max-width: 30%; margin: 3px; padding: 5px 3px 3px 7px; font-size: 14px;",onclick:function(e){var t="SPAN"==e.target.nodeName?e.target.parentNode.previousElementSibling:e.target.previousElementSibling,n=h.htmlspecialchars(h.trim(t.previousElementSibling.value)),s=h.htmlspecialchars(h.trim(t.value));"SP_KEY_IMPORT"==n||"SP_PLUS_SET"==n?h.alertm("Это служебное значение скрипта, не изменяйте его!",1,null):""!=n?h.confirmm(("SP_KEY_IMPORT"==n||"SP_PLUS_SET"==n?"<b style='color: #FF0000;'>Внимание, <span style='color: #0000FF;'>\""+n+'"</span> является служебным значение скрипта, не стоит его изменять!</b><br/>':"")+"Хотите добавить куку <span style='color: #0000FF;'>\""+n+"\"</span> со значением <span style='color: #0000FF;'>\""+s+'"</span>?',function(){h.setCookie(t.previousElementSibling.value,t.value,null),h.cookieEditor("#SP_PLUS_SETAREA")}):h.alertm("Задайте имя cookie!",1,null)}});for(var d in r.appendChild(o),r.appendChild(c),r.appendChild(p),s.appendChild(r),s.appendChild(h.ce("div",{html:'<label class="label" style="padding-top: 15px;margin-bottom: 2px;">Список существующий cookies:</label>'})),n)if("SP_KEY_IMPORT"!=d&&"SP_PLUS_SET"!=d){var u=h.ce("div",{class:"text-input__wrap",style:"text-align: center;"}),_=h.ce("input",{type:"text",class:"text-input",placeholder:"Имя",attr:{readonly:"readonly"},value:d,style:"width: 30%; margin: 3px;",onclick:function(e){e.target.select()}}),m=h.ce("input",{type:"text",class:"text-input",placeholder:"Значение",value:n[d],style:"width: 30%; margin: 3px;"}),g=h.ce("button",{html:"<span class='sp_plus_ico_del'></span>",title:"Удалить",style:"max-width: 15%; margin: 3px; padding: 5px 3px 3px 7px; font-size: 14px;",onclick:function(e){var t="SPAN"==e.target.nodeName?e.target.parentNode.previousElementSibling.previousElementSibling:e.target.previousElementSibling.previousElementSibling,n=h.htmlspecialchars(h.trim(t.value));"SP_KEY_IMPORT"==n||"SP_PLUS_SET"==n?h.alertm("Это служебное значение скрипта, не удаляйте его!",1,null):""!=n?h.confirmm(("SP_KEY_IMPORT"==n||"SP_PLUS_SET"==n?"<b style='color: #FF0000;'>Внимание, <span style='color: #0000FF;'>\""+n+'"</span> является служебным значение скрипта, не стоит его удалять!</b><br/>':"")+"Хотите удалить куку <span style='color: #0000FF;'>\""+n+'"</span>?',function(){h.delCookie(t.value),h.cookieEditor("#SP_PLUS_SETAREA")}):h.alertm("Пустую куку удалить?! Ты, блять, серьёзно???",1,null)}}),v=h.ce("button",{title:"Сохранить",html:"<span class='sp_plus_ico_okb'></span>",style:"max-width: 15%; margin: 3px; padding: 5px 3px 3px 7px; font-size: 14px;",onclick:function(e){var t="SPAN"==e.target.nodeName?e.target.parentNode.previousElementSibling.previousElementSibling:e.target.previousElementSibling.previousElementSibling,n=h.htmlspecialchars(h.trim(t.previousElementSibling.value)),s=h.htmlspecialchars(h.trim(t.value));"SP_KEY_IMPORT"==n||"SP_PLUS_SET"==n?h.alertm("Это служебное значение скрипта, не изменяйте его!",1,null):""!=n?h.confirmm(("SP_KEY_IMPORT"==n||"SP_PLUS_SET"==n?"<b style='color: #FF0000;'>Внимание, <span style='color: #0000FF;'>\""+n+'"</span> является служебным значение скрипта, не стоит его изменять!</b><br/>':"")+"Хотите задать куке <span style='color: #0000FF;'>\""+n+"\"</span> значение <span style='color: #0000FF;'>\""+s+'"</span>?',function(){h.setCookie(t.previousElementSibling.value,t.value,null),h.cookieEditor("#SP_PLUS_SETAREA")}):h.alertm("Имя не должно быть пустым!",1,null)}});u.appendChild(_),u.appendChild(m),u.appendChild(g),u.appendChild(v),s.appendChild(u)}}catch(e){h.console.error("Ошибка (COOKIE_EDITOR): "+e.name+":"+e.message+"\n"+e.stack)}},spacesAction:function(e){var t=h.ce("div",{id:"wrap_spaces_option",style:"padding-left: 7px; margin-left: 7px; border-left: 5px solid #92BEE2;"}),n=h.ce("a",{href:'javascript:var Arr=[\'<div class="time-block" style="text-align: left;" id="wrap_spacesAction_AD"><a href="#" id="api_debug-button">API-Debugger</a><div id="api_debug-place"></div></div>\',"append","parent","#navi","debugger"];$(Arr[3])[Arr[2]]()[Arr[1]](Arr[0]),require(Arr[4]);void(0);',class:"sp_plus_a",id:"sp_spacesAction_AD",html:"API-Debugger",style:"font-size: small;",onclick:function(e){var t=h.qs("#wrap_spacesAction_AD");return!t||(h.remove(t),h.setLocation(document.location.href),!1)}}),s=h.getCookie("beta"),i=h.ce("a",{href:"#",class:"sp_plus_a",id:"sp_spacesAction_beta",html:s?"Выйти из песочницы":"Beta-песочница",style:"font-size: small;",onclick:function(e){return s?h.delCookie("beta"):h.setCookie("beta","1",null),document.location.reload(),!0}}),a=h.getCookie("force_ajax_transport"),l=h.ce("a",{href:"#",class:"sp_plus_a",id:"sp_spacesFAT",html:a?"Убрать полосу загрузки":"Добавить полосу загрузки",style:"font-size: small;",onclick:function(e){return a?h.delCookie("force_ajax_transport"):h.setCookie("force_ajax_transport","1",null),document.location.reload(),!0}}),r=h.getCookie("gp_left_btn"),o=h.ce("a",{href:"#",class:"sp_plus_a",id:"sp_spacesGLB",html:r?"Убрать плеер из панели":"Плеер в левой панели",style:"font-size: small;",onclick:function(e){return r?h.delCookie("gp_left_btn"):h.setCookie("gp_left_btn","1",null),document.location.reload(),!0}});t.appendChild(n),t.appendChild(h.ce("br",null)),t.appendChild(i),t.appendChild(h.ce("br",null)),t.appendChild(l),t.appendChild(h.ce("br",null)),t.appendChild(o),e.appendChild(t)},setLocation:function(e){e=e||document.location.href.toString();var t=h.qs("#SP_PLUS_SETLOCATIONLINK"),n=document.createEvent("MouseEvent");n.initEvent("click",!0,!0),t?(t.href=e,t.dispatchEvent(n)):(t=h.ce("a",{href:e,style:"display: none;",id:"SP_PLUS_SETLOCATIONLINK"}),document.body.appendChild(t),t.dispatchEvent(n))},isValidUrl:function(e){return/^(?:(?:https?|ftp|telnet):\/\/(?:[а-я0-9_-]{1,32}(?::[а-я0-9_-]{1,32})?@)?)?(?:(?:[а-я0-9-]{1,128}\.)+(?:рф)|(?! 0)(?:(?! 0[^.]|255)[ 0-9]{1,3}\.){3}(?! 0|255)[ 0-9]{1,3})(?:\/[a-zа-я0-9.,_@%&?+=\~\/-]*)?(?:#[^ \'\"&<>]*)?$/i.test(e)||/^(?:(?:https?|ftp|telnet):\/\/(?:[a-z0-9_-]{1,32}(?::[a-z0-9_-]{1,32})?@)?)?(?:(?:[a-z0-9-]{1,128}\.)+(?:com|net|org|mil|edu|arpa|ru|gov|biz|info|aero|inc|name|[a-z]{2})|(?! 0)(?:(?! 0[^.]|255)[ 0-9]{1,3}\.){3}(?! 0|255)[ 0-9]{1,3})(?:\/[a-zа-я0-9.,_@%&?+=\~\/-]*)?(?:#[^ \'\"&<>]*)?$/i.test(e)},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},rand:function(e,t){return Math.round(Math.random()*(t-e))+e},inBefore:function(e,t){return t.parentNode.insertBefore(e,t)},insertAfter:function(e,t){var n=t.parentNode,s=t.nextSibling;if(n)return s?n.insertBefore(e,s):n.appendChild(e)},qs:function(e){return document.querySelector(e)},getClassName:function(e,t){e=e.split(".");for(var n=new Array,s=document.getElementsByTagName(e[0]),i=0;i<s.length;i++)s[i].className.indexOf(e[1])>=0&&!t?n.push(s[i]):s[i].className==e[1]&&t&&n.push(s[i]);return n[0]?n:null},declOfNum:function(e,t){return t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]},console:{info:function(e){var t=new Date;e="("+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+") "+e,f.debug,console.info(e),t=null},error:function(e){var t=new Date;e="("+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+") "+e,f.debug,console.error(e),t=null},log:function(e){var t=new Date;e="("+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+") "+e,f.debug,console.log(e),t=null},debug:function(e){var t=new Date;e="("+(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+") "+e,f.debug,console.debug(e),t=null},remove:function(){h.remove(h.qs("#SP_PLUS_CONSOLE")),h.remove(h.qs("#SP_PLUS_CONSOLE_CLEAR"))}},consoleAppend:function(e,t){try{o++;var n=h.qs("#SP_PLUS_CONSOLE"),s=h.ce("span",{style:"color: "+t+";",html:"&gt;&nbsp;"+e});if(n)n.appendChild(s),n.appendChild(h.ce("br",null));else{n=h.ce("div",{id:"SP_PLUS_CONSOLE",style:"position: fixed; bottom: 0px; width: 100%; margin: 0px; height: 100px; background: #000000; color: #808080; font-size: 12px; border-top: 2px solid #505050; overflow-x: auto; overflow-y: visible; z-index: 999998; line-height: 1.5; padding: 7px; display: none;"});var i=h.ce("div",{html:"Консоль ("+o+")",title:"Показать консоль",id:"SP_PLUS_CONSOLE_CLEAR",style:"position: fixed; font-size: 12px; opacity: 0.7; border-radius: 3px 0px 0px 0px; border: 1px solid #505050; padding: 5px; z-index: 999999; cursor: pointer; background: #808080; right: 0px; bottom: 0px;",onclick:function(e){""==n.style.display?(n.style.display="none",e.target.title="Показать консоль"):(n.style.display="",e.target.title="Скрыть консоль")}}),a=h.ce("span",{html:"x",title:"Очистить консоль",style:"color: #F5F5F5; position: fixed; right: 7px; padding: 5px; cursor: pointer; margin-right: 15px;",onclick:function(e){n.innerHTML="",o=0,i.innerHTML="Консоль (0)"}});n.appendChild(a),n.appendChild(s),n.appendChild(h.ce("br",null)),document.body.appendChild(n),document.body.appendChild(i)}n.scrollTop=999999999999,h.qs("#SP_PLUS_CONSOLE_CLEAR")&&(h.qs("#SP_PLUS_CONSOLE_CLEAR").innerHTML="Консоль ("+o+")")}catch(e){h.console.error("Ошибка (SP_CONSOLE): "+e.name+":"+e.message+"\n"+e.stack)}},time2str:function(e){var t=parseInt(e,10);if(isNaN(t))return h.console.info(t),null;var n=parseFloat(t/3600).toFixed(2).toString();return(n=n.split("."))[0]+" ч, "+parseInt(n[1]/(100/60),10)+" мин"},setSelection:function(e){var t,n;document.createRange?((n=document.createRange()).selectNode(e),(t=window.getSelection()).removeAllRanges(),t.addRange(n)):((n=document.body.createTextRange()).moveToElementText(e),n.select())},sound:function(e,t){try{var n=new Audio(e);n.volume=t/100,n.play()}catch(e){h.console.error("Ошибка (SOUND): "+e.name+":"+e.message+"\n"+e.stack)}},events:function(){try{var e={mail:h.qs("#mail_notif_cnt"),journal:h.qs("#jour_notif_cnt"),feed:h.qs("#lent_notif_cnt")},t=h.getCookie("spacesactive"),n=0;for(var s in e)e[s]&&f.events[s]&&""!=e[s].innerHTML&&!isNaN(e[s].innerHTML)&&(n+=parseInt(e[s].innerHTML,10));if(n>a){if("false"==t&&(h.sound(f.events.url+"?r="+h.rand(1e3,9999),f.events.volume),f.events.notifications)){var i=h.declOfNum(n,["новое событие","новых события","новых событий"]);h.notifications("Новые события на Spaces!",{body:"У Вас "+n+" "+i+"!",icon:_,tag:"events"},null)}a=n,h.console.info("Новые события: "+n+", вкладка активна: "+t)}else n<a&&(a=n,h.console.info("Скидываем счётчик до: "+n))}catch(e){h.console.error("Ошибка (EVENTS): "+e.name+":"+e.message+"\n"+e.stack)}},friendsOnline:function(t){var n=h.qs("#friends_cnt"),s=h.qs("#SP_PLUS_FRIENDSSB"),i=0;if(n&&!isNaN(n.innerHTML)&&(i=parseInt(n.innerHTML,10)),n)try{if(f.friendsListSH?s&&(n.parentNode.title||(n.parentNode.title="Скрыть список"),n.parentNode.hasAttribute("sp-click-el")||(n.parentNode.onclick=function(e){return"none"!=s.style.display?(s.style.display="none",e.target.parentNode.title="Показать список"):(s.style.display="",e.target.parentNode.title="Скрыть список"),!1},n.parentNode.setAttribute("sp-click-el","1"))):(n.parentNode.title="",n.parentNode.removeAttribute("sp-click-el"),n.parentNode.onclick=null,s&&"none"==s.style.display&&(s.style.display="")),t)if(i>0){if(c++,i!=l||i>0&&!s||c>=700){c>=700&&(c=0,h.console.info("[S+] Принудительно обновляем друзей!")),l=i;var a=n.parentNode.parentNode.parentNode;s=s||h.ce("div",{id:"SP_PLUS_FRIENDSSB",class:"list-link__wrap"}),h.jajax(e+"//spaces.ru/friends/?S=3",function(t){try{var i=h.extend({tabbed_panel:{tabs:[null,{content:{list:null}}]}},JSON.parse(t)).tabbed_panel.tabs[1].content.list;i?h.jajax(e+"//spaces.ru/friends/?P=2&S=3",function(t){var a=h.extend({tabbed_panel:{tabs:[null,{content:{list:{avatar:[null,{previewURL:null,name:null}],online_label:[null,{online_status:null,on_img:null}]}}}]}},JSON.parse(t)).tabbed_panel.tabs[1].content.list;a=a?h.extend(i,a):i,s.innerHTML="";var r=f.friendsOnMax>a.length?a.length:f.friendsOnMax;l!=a.length&&d<3?(d++,setTimeout(function(){l=a.length,h.console.info("[S+] Количество друзей не точное, пробуем еще раз ("+d+" из 3)")},1e3)):l==a.length&&(d=0);for(var o=0;o<r;o++)s.appendChild(h.ce("a",{href:e+"//spaces.ru/mysite/?name="+a[o].name,class:"li",html:'<span class="comm_ava m for_avatar"><img src="'+a[o].avatar.previewURL+'" alt="" class="preview s21_20"></span><span class="online-status m"><img class="p14 online_status_ico" src="'+e+"//spac.me/i/"+a[o].online_status.on_img+'" alt="(ON)"></span><span class="block-item__title m break-word">'+a[o].name+"</span>"}));n.parentNode.removeAttribute("sp-click-el"),h.console.info("[S+] Обновили друзей!")}):h.remove(s)}catch(e){h.console.error("Ошибка (FRIENDS_ONLINE_JSON): "+e.name+":"+e.message+"\n"+e.stack)}}),a.appendChild(s)}}else 0==i&&s&&h.remove(s);else s&&(h.remove(s),l=0,h.console.info("[S+] Вырубили друзей из панели!")),n.parentNode.onclick=null,n.parentNode.removeAttribute("sp-click-el"),c=0}catch(e){h.console.error("Ошибка (FRIENDS_ONLINE): "+e.name+":"+e.message+"\n"+e.stack)}},online:function(){document.location.href.replace(/\#.*$/i,"");var n=document.location.pathname.toString();if("/anketa/"==n)try{var s=h.getQuery("user")||h.service(0),i=h.getClassName("div.info-item__title",1);i||(i=h.getClassName("span.light_item",1)),s&&i&&t!=s&&(t=s,h.jajax(e+"//spaces.ru/anketa/?user="+s,function(e){if(e)try{var t=h.extend({user_widget:{online_time:null}},JSON.parse(e));if(t.user_widget.online_time){var n=h.time2str(t.user_widget.online_time);for(var s in i)if("Время онлайн:"==i[s].innerHTML){var a=i[s].nextElementSibling||i[s].nextSibling;3==a.nodeType?a.data=" "+n:a.innerHTML=n,h.console.info("[S+] Время онлайн: "+n)}}}catch(e){h.console.error("Ошибка (JSON_ONLINE): "+e.name+":"+e.message+"\n"+e.stack)}}))}catch(e){h.console.error("Ошибка (ONLINE): "+e.name+":"+e.message+"\n"+e.stack)}else"/anketa/"!=n&&(t=null)},favorite:function(){var t=document.location.href,i=document.location.pathname.toString();t!=e+"//spaces.ru/bookmarks/add/?irb526786=1"||s||(s=t,h.setLocation(e+"//spaces.ru/bookmarks/?irb526786=1"));var a=null;if("/anketa/"==i){var l=document.links;(a=h.find(l,{href:e+"//spaces.ru/bookmarks/add/?"}))||(a=h.find(l,{href:e+"//spaces.ru/bookmarks/edit/?"}))}if("/mysite/"!=i&&"/anketa/"!=i&&"/activity/"!=i||a||n==t)"/mysite/"!=i&&"/anketa/"!=i&&"/activity/"!=i&&(n=null);else{var r=h.qs("#SP_PLUS_INFAVORITE");n=t;try{var o=h.getQuery("user");o||(o=h.getQuery("name")||h.service(0));var c=h.getClassName("td.table__cell table__cell_last",1);o&&c&&c[0].innerHTML.indexOf("Вперёд")<0&&!r&&h.jajax(e+"//spaces.ru/anketa/?user="+o,function(t){if(t)try{var n,s=h.extend({user_widget:{id:null}},JSON.parse(t));if(s.user_widget.id){n="A"==c[0].firstElementChild.nodeName?c[0].firstElementChild.className.split(" ")[0]:"stnd-link";var i=r||h.ce("td",{class:"table__cell",id:"SP_PLUS_INFAVORITE"});i.innerHTML='<a href="'+e+"//spaces.ru/bookmarks/add/?object_id="+s.user_widget.id+'&object_type=11" class="'+n+'" title="Добавить в закладки"><span class="ico ico_fav_grey js-ico"></span> B закладки</a>',h.isFav(s.user_widget.id,i,o,'<span class="ico ico_fav_on js-ico"></span><span style="color: #108210;"> В закладках</span>'),r||h.inBefore(i,c[0]);var a=c[0].parentNode.childNodes;for(var l in a)"TD"==a[l].nodeName&&(a[l].width="25%")}}catch(e){h.console.error("Ошибка (JSON_FAVORITE): "+e.name+":"+e.message+"\n"+e.stack)}})}catch(e){h.console.error("Ошибка (FAVORITE): "+e.name+":"+e.message+"\n"+e.stack)}}},isFav:function(t,n,s,i){h.jajax(e+"//spaces.ru/bookmarks/add/?object_id="+t+"&object_type=11",function(e){if(e)try{var t=h.extend({delete_link:{delete_URL:null}},JSON.parse(e));if(t.delete_link.delete_URL){var a=t.delete_link.delete_URL.replace(/&amp;/g,"&");n.firstElementChild.href=a,n.firstElementChild.title="Удалить из закладок",n.firstElementChild.innerHTML=i,n.firstElementChild.onclick=function(){return h.confirmm("Хотите удалить пользователя "+s+" из закладок?",function(){h.setLocation(a)}),!1}}}catch(e){h.console.error("Ошибка (JSON_ISFAVORITE): "+e.name+":"+e.message+"\n"+e.stack)}})},bannedHTML:function(t,n,s,i){return n?'<div class="widgets-group links-group">'+(i?'<span id="SP_PLUS_INFAV"><a href="'+e+"//spaces.ru/bookmarks/add/?object_id="+i+'&object_type=11" id="SP_PLUS_INFAV" class="list-link list-link_arrow list-link_first"><span class="ico ico_fav_grey js-ico"></span> Добавить в закладки<span class="ico ico_arr"></span></a></span>':"")+'<a href="'+e+"//spaces.ru/gifts/user_list/?user="+t+'" class="list-link list-link_arrow list-link_first"><span class="ico ico_gifts_blue"></span> Подарки<span class="ico ico_arr"></span></a>'+(s?"":'<a href="'+e+"//spaces.ru/guestbook/?name="+t+'" class="list-link list-link_arrow list-link_first"><span class="ico ico_gb"></span> Гостевая<span class="ico ico_arr"></span></a><a href="'+e+"//spaces.ru/diary/?name="+t+'" class="list-link list-link_arrow"><span class="ico ico_blog"></span> Личный блог<span class="ico ico_arr"></span></a>')+'<a href="'+e+"//spaces.ru/forums/search_user/?Comm=0&Ext=1&word="+t+'" class="list-link list-link_arrow"><span class="ico ico_forum"></span> Темы и комментарии <span class="ico ico_arr"></span></a>'+(s?"":'<div class="sep-item"></div><a href="'+e+"//spaces.ru/pictures/?P=1&amp;name="+t+'" class="list-link list-link_arrow"><span class="ico ico_photo"></span> Фотографии<span class="ico ico_arr"></span></a><a href="'+e+"//spaces.ru/music/?P=1&amp;name="+t+'" class="list-link list-link_arrow"><span class="ico ico_music"></span> Музыка<span class="ico ico_arr"></span></a><a href="'+e+"//spaces.ru/video/?P=1&amp;name="+t+'" class="list-link list-link_arrow"><span class="ico ico_video"></span> Видео<span class="ico ico_arr"></span></a><a href="'+e+"//spaces.ru/files/?P=1&amp;name="+t+'" class="list-link list-link_arrow"><span class="ico ico_file"></span> Файлы<span class="ico ico_arr"></span></a>')+'<div class="sep-item"></div><a href="'+e+"//spaces.ru/comm/?List=1&user="+t+'" class="list-link list-link_arrow"><span class="ico ico_comm"></span> Сообщества<span class="ico ico_arr"></span></a><a href="'+e+"//spaces.ru/friends/?name="+t+'&amp;p=1" class="list-link list-link_arrow"><span class="ico ico_friends"></span> Друзья<span class="ico ico_arr"></span></a><a href="'+e+"//spaces.ru/lenta/readers/?user="+t+'" class="list-link list-link_arrow"><span class="ico ico_readers"></span> Читатели<span class="ico ico_arr"></span></a></div>':'<div class="no_underline_block start_page_padd light_border_bottom lh_160" style="padding-top:1px;">'+(i?'<div id="SP_PLUS_INFAV"><a href="'+e+"//spaces.ru/bookmarks/add/?object_id="+i+'&object_type=11"><img src="'+e+'//spac.me/i/action_fav_gray.gif" alt="" class="m p16"> <span class="m"> Добавить в закладки</span></a></div>':"")+'<div><a href="'+e+"//spaces.ru/gifts/user_list/?user="+t+'"><img src="'+e+'//spac.me/i/sendgift.gif" alt="" class="m p16"> <span class="m">Подарки</span></a></div>'+(s?"":'<div> <a href="'+e+"//spaces.ru/guestbook/?name="+t+'&amp;p=0"><img src="'+e+'//spac.me/i/guestbook.gif" alt="" class="m p16"> <span class="m">Гостевая</span></a></div><div> <a href="'+e+"//spaces.ru/diary/?name="+t+'"><img src="'+e+'//spac.me/i/diary.gif" alt="" class="m p16"> <span class="m">Блог</span></a></div>')+'</div><div class="no_underline_block start_page_padd light_blue light_border_bottom lh_160">'+(s?"":'<div> <a href="'+e+"//spaces.ru/pictures/?P=1&amp;name="+t+'"><img src="'+e+'//spac.me/i/PhotoIcon.gif" alt="" class="m p16"> <span class="m">Фото</span></a></div><div> <a href="'+e+"//spaces.ru/music/?P=1&amp;name="+t+'"><img src="'+e+'//spac.me/i/file_mp3.gif" alt="" class="m p16"> <span class="m">Музыка</span></a></div><div> <a href="'+e+"//spaces.ru/video/?P=1&amp;name="+t+'"><img src="'+e+'//spac.me/i/icon_video.gif" alt="" class="m p16"> <span class="m">Видео</span></a></div><div> <a href="'+e+"//spaces.ru/files/?P=1&amp;name="+t+'"><img src="'+e+'//spac.me/i/film.gif" alt="" class="m p16"> <span class="m">Файлы</span></a></div>')+'<div> <a href="'+e+"//spaces.ru/forums/search_user/?Comm=0&Ext=1&word="+t+'"><img src="'+e+'//spac.me/i/Forum.gif" alt="" class="m p16"> <span class="m">Темы и комментарии</span></a> </div></div><div class="no_underline_block start_page_padd light_border_bottom lh_160"><div> <a href="'+e+"//spaces.ru/friends/?name="+t+'"><img src="'+e+'//spac.me/i/friends.gif" alt="" class="m p16"> <span class="m">Друзья</span></a></div><div> <a href="'+e+"//spaces.ru/comm/?List=1&user="+t+'"> <img src="'+e+'//spac.me/i/soo.gif" alt="" class="m p16"> <span class="m">Сообщества</span></a></div><div> <a href="'+e+"//spaces.ru/lenta/readers/?user="+t+'"><img src="'+e+'//spac.me/i/icon_readers.gif" alt="" class="m p16"> <span class="m">Читатели</span></a></div></div>'},gifts:function(){document.location.href.replace(/\#.*$/i,"");var t=document.location.pathname.toString(),n=h.qs("#SP_PLUS_GIFT");if("/mysite/"==t&&!n)try{var s=h.getQuery("name")||h.service(0),i=document.getElementsByTagName("img"),a=h.find(i,{src:"/i/gifts/40/"});if(a||(a=h.find(i,{src:"/i/gifts/25/"})),a&&s){var l=!0;for(var r in a){var o=0,c=h.ce("i",{style:"color: #FFFFFF; background-color: #000000; border-radius: 3px; padding: 5px; position: absolute; display: none; top: -40px; z-index:9999999; opacity: 0.8",id:"SP_PLUS_GIFT"});c.innerHTML="",h.insertAfter(c,a[r].parentNode),a[r].parentNode.parentNode.style.position="relative",a[r].parentNode.parentNode.style.display="inline",a[r].ontouchstart=function(t){if(l){var n=t.target.parentNode;/#gift([0-9]+)$/i.test(n.href)?o=/#gift([0-9]+)$/i.exec(n.href)[1]:/(\?|&)gift=([0-9]+)/i.test(n.href)&&(o=/(\?|&)gift=([0-9]+)/i.exec(n.href)[2]);var i=n.nextElementSibling;i.style.display="",""==i.innerHTML&&(i.innerHTML="<img src='"+e+"//spac.me/i/spinner2.gif' alt='' style='height: 16px !important;'>",h.jajax(e+"//spaces.ru/gifts/details/?gift="+o+"&user="+s,function(t){try{if(t){var n=h.extend({gift_widget:{from_user:{widget:{siteLink:{user_name:null}}},date:null,message:null}},JSON.parse(t));if(n.gift_widget.from_user){var s=n.gift_widget.from_user.widget.siteLink.user_name;i.innerHTML='<div><a href="'+e+"//spaces.ru/mysite/?name="+("Система"==s?"4839":s)+'" style="color: #FFFFFF !important">'+s+"</a><small>&nbsp;("+n.gift_widget.date+')</small></div><div class="sp_plus_small"><small>'+n.gift_widget.message+"</small></div>"}else i.innerHTML="Неизвестный"}}catch(e){i.innerHTML="Неизвестный",h.console.error("Ошибка (JSON_GIFTS): "+e.name+":"+e.message+"\n"+e.stack)}}))}else t.target.parentNode.nextElementSibling.style.display="none"},a[r].ontouchend=function(e){l=!l},a[r].onmouseenter=function(t){var n=t.target.parentNode;/#gift([0-9]+)$/i.test(n.href)?o=/#gift([0-9]+)$/i.exec(n.href)[1]:/(\?|&)gift=([0-9]+)/i.test(n.href)&&(o=/(\?|&)gift=([0-9]+)/i.exec(n.href)[2]);var i=n.nextElementSibling;i.onmouseenter=function(){i.style.display=""},i.onmouseleave=function(){i.style.display="none"},i.style.display="",""==i.innerHTML&&(i.innerHTML="<img src='"+e+"//spac.me/i/spinner2.gif' alt='' style='height: 16px !important;'>",h.jajax(e+"//spaces.ru/gifts/details/?gift="+o+"&user="+s,function(t){try{if(t){var n=h.extend({gift_widget:{from_user:{widget:{siteLink:{user_name:null}}},date:null,message:null}},JSON.parse(t));if(n.gift_widget.from_user){var s=n.gift_widget.from_user.widget.siteLink.user_name;i.innerHTML='<div><a href="'+e+"//spaces.ru/mysite/?name="+("Система"==s?"4839":s)+'" style="color: #FFFFFF !important">'+s+"</a><small>&nbsp;("+n.gift_widget.date+')</small></div><div class="sp_plus_small"><small>'+n.gift_widget.message+"</small></div>"}else i.innerHTML="Неизвестный"}}catch(e){i.innerHTML="Неизвестный",h.console.error("Ошибка (JSON_GIFTS): "+e.name+":"+e.message+"\n"+e.stack)}}))},a[r].onmouseleave=function(e){e.target.parentNode.nextElementSibling.style.display="none"}}}}catch(e){h.console.error("Ошибка (GIFTSTOOLS): "+e.name+":"+e.message+"\n"+e.stack)}},bannedTools:function(){var t=document.location.href.replace(/\#.*$/i,""),n=document.location.pathname.toString(),s=!0,a=h.qs("#SP_PLUS_BNDBLOCK");if("/mysite/"==n&&i!=t)try{var l=h.getQuery("user");l||(l=h.getQuery("name")||h.service(0)),i=t,a&&h.remove(a),l&&h.jajax(e+"//spaces.ru/mysite/?name="+l,function(t){try{if(t){var n=h.qs("#siteContent");n||(n=h.getClassName("div.main",null))&&(n=n[0],s=!1);var i=h.extend({owner_id:null,owner_widget:{ban_info:{deleted:null,frozen:null,blocked:null}}},JSON.parse(t));if(i.owner_widget.ban_info&&i.owner_id&&n){var r=!1,o=i.owner_id;i.owner_widget.ban_info.deleted?h.console.info("[S+] Аккаунт удален!"):i.owner_widget.ban_info.frozen?h.console.info("[S+] Аккаунт покинут!"):i.owner_widget.ban_info.blocked&&(h.console.info("[S+] Аккаунт забанен!"),r=!0);var c=a||h.ce("div",{id:"SP_PLUS_BNDBLOCK"});c.innerHTML=h.bannedHTML(l,s,r,o),a||n.appendChild(c),o&&h.isFav(o,h.qs("#SP_PLUS_INFAV"),l,s?'<span class="ico ico_fav_on js-ico"></span> Удалить из закладок<span class="ico ico_arr"></span>':'<img src="'+e+'//spac.me/i/action_fav_color.gif" alt="" class="m p16"> <span class="m"> Удалить из закладок</span>')}}}catch(e){h.console.error("Ошибка (JSON_BLOCKED): "+e.name+":"+e.message+"\n"+e.stack)}})}catch(e){h.console.error("Ошибка (BLOCKED): "+e.name+":"+e.message+"\n"+e.stack)}else"/mysite/"!=n&&(a&&h.remove(a),i=null)},extend:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},service:function(e){try{var t=document.getElementsByTagName("script").item(0);if(e){if(/REVISION\s?=\s?'(.*?)'/i.test(t.innerHTML)){var n=h.trim(/REVISION\s?=\s?'(.*?)'/i.exec(t.innerHTML)[1]);return""==n?null:n}return null}if(/name:'(.*?)'/i.test(t.innerHTML)){var s=h.trim(/name:'(.*?)'/i.exec(t.innerHTML)[1]);return""==s?null:s}return null}catch(e){return null}},getCK:function(e){var t=h.getCookie("sid");return e?t:t.substr(-4)},allCookie:function(){var e=new Object,t=document.cookie;if(t&&""!=h.trim(t))for(var n=t.split(";"),s=0;s<n.length;s++){var i=h.trim(n[s]);if(""!=i){var a=i.split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}}return e},getCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},delCookie:function(e){h.setCookie(e,null,{expires:-1})},setCookie:function(e,t,n){!(n=h.extend({path:"/",expires:365,secure:!1,domain:".spaces.ru"},n)).expires||n.expires instanceof Date||(n.expires=new Date(+new Date+864e5*n.expires));var s=encodeURIComponent(e)+"="+encodeURIComponent(t);n.expires&&(s+="; expires="+n.expires.toUTCString()),n.domain&&(s+="; domain="+n.domain),n.path&&(s+="; path="+n.path),n.secure&&(s+="; secure"),document.cookie=s},find:function(e,t){for(var n=new Array,s=0;s<e.length;s++)for(var i in t)e[s][i].indexOf(t[i])>=0&&n.push(e[s]);return n[0]?n:null},readersDelete:function(){if("/lenta/readers/"==document.location.pathname.toString()&&!h.qs("#SP_PLUS_BOTTOM_DIVB"))try{var t=h.find(document.links,{href:e+"//spaces.ru/lenta/reader_delete/?"});if(t&&!h.qs("#SP_PLUS_BOTTOM_DIVB")){var n=h.getCK(0),s=new Array;for(var i in t){t[i].style.textAlign="center";var a=h.ce("div",{class:"stnd-link icon-link",style:"right: 50px;top: -42px; padding-left: 8px; padding-right: 8px;"}),l=h.ce("input",{type:"checkbox",id:"SP_DR_"+/(\?|&)user=([A-Za-z0-9\_]+)/i.exec(t[i].href)[2],class:"sp_plus_checkbox"}),r=h.ce("label",{style:"margin-left: 0px;",attr:{for:"SP_DR_"+/(\?|&)user=([A-Za-z0-9\_]+)/i.exec(t[i].href)[2]}});a.appendChild(l),a.appendChild(r),h.insertAfter(a,t[i]),s.push(l)}var o=t[t.length-1].parentNode;if(o&&(o=o.parentNode),o){var c=h.ce("div",{class:"user__tools_last",id:"SP_PLUS_BOTTOM_DIVB"}),p=h.ce("button",{class:"user__tools-link table__cell",style:"width: 50%; display: inline-block; box-sizing: border-box;",html:'<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">Выбрать все</span>',onclick:function(e){for(var t="SPAN"==e.target.nodeName?e.target.parentNode:e.target,n=0;n<s.length;n++)t.innerHTML.indexOf("Выбрать все")>=0?s[n].checked=!0:s[n].checked=!1;return t.innerHTML='<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">'+(t.innerHTML.indexOf("Выбрать все")>=0?"Снять отметки":"Выбрать все")+"</span>",!1}}),d=h.ce("button",{class:"user__tools-link table__cell",style:"width: 50%; display: inline-block; border-right: 1px solid #cdd4e1; box-sizing: border-box;",html:'<span class="sp_plus_ico_del"></span><span style="color: #F86934;">Удалить выбранных</span>',onclick:function(){var t=0,i=new Array;p.innerHTML='<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">Выбрать все</span>';for(var a=0;a<s.length;a++)if(1==s[a].checked){var l=/^SP_DR_([A-Za-z0-9\_]+)$/i.exec(s[a].id)[1];i.push(l),s[a].checked=!1,t++}if(t>0){var r=h.declOfNum(t,["я","я","ей"]);h.confirmm("Хотите удалить "+t+" читател"+r+"?",function(){var s=setInterval(function(){h.alertm("Удаляем читателей: <span style='color: #008000;'>"+t+"</span><br/><a href='#' onclick='return false;' id='SP_PLUS_CANCEL' class='sp_plus_a'>Отмена</a>",0,null);var a=i[--t];h.ajax(e+"//spaces.ru/lenta/reader_delete/?user="+a,"POST","&CK="+n+"&cfms=Удалить",function(e){h.console.info("[S+] Удалили читателей: "+a)},2),h.qs("#SP_PLUS_CANCEL").onclick=function(){i=null,clearInterval(s),h.alertm("Отменено!<br/><a href='"+document.location.href.replace(/\#.*$/i,"")+"' onclick='document.body.removeChild(this.parentNode); return true;' class='sp_plus_a'>Обновить страницу</a>",1,null)},t<1&&(i=null,clearInterval(s),h.alertm("Готово!<br/><a href='"+document.location.href.replace(/\#.*$/i,"")+"' onclick='document.body.removeChild(this.parentNode); return true;' class='sp_plus_a'>Обновить страницу</a>",1,null))},500)})}else h.alertm("Не выбрано ни одного читателя!",1,null);return!1}});c.appendChild(d),c.appendChild(p),h.insertAfter(c,o)}else{for(i=0;i<s.length;i++)s[i].style.display="none";c=h.ce("div",{style:"display: none;",id:"SP_PLUS_BOTTOM_DIVB"}),document.body.appendChild(c)}}}catch(e){h.console.error("Ошибка (READERS): "+e.name+":"+e.message+"\n"+e.stack)}},blogsDelete:function(){var t=document.location.pathname.toString();if(("/diary/"==t||"/diary/view/"==t)&&!h.qs("#SP_PLUS_BOTTOM_DIVB"))try{var n=h.find(document.links,{href:e+"//spaces.ru/diary/editaccess/?id="});if(n&&!h.qs("#SP_PLUS_BOTTOM_DIVB")){for(var s=h.getCK(0),i=new Array,a=0;a<n.length;a++)if(n[a].className){n[a].style.textDecoration="none";var l=h.ce("input",{type:"checkbox",id:"SP_DB_"+/\?id=([0-9]+)/i.exec(n[a].href)[1],class:"sp_plus_checkbox"}),r=h.ce("label",{attr:{for:"SP_DB_"+/\?id=([0-9]+)/i.exec(n[a].href)[1]}});h.insertAfter(l,n[a]),h.insertAfter(r,l),i.push(l)}var o=i[i.length-1].parentNode;if(o&&(o=o.parentNode),o&&(o=o.parentNode),o&&(o=o.parentNode),o){var c=h.ce("div",{class:"widgets-group user__tools_last",id:"SP_PLUS_BOTTOM_DIVB"}),p=h.ce("button",{class:"user__tools-link table__cell",style:"width: 50%; display: inline-block; box-sizing: border-box;",html:'<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">Выбрать все</span>',onclick:function(e){for(var t="SPAN"==e.target.nodeName?e.target.parentNode:e.target,n=0;n<i.length;n++)t.innerHTML.indexOf("Выбрать все")>=0?i[n].checked=!0:i[n].checked=!1;return t.innerHTML='<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">'+(t.innerHTML.indexOf("Выбрать все")>=0?"Снять отметки":"Выбрать все")+"</span>",!1}}),d=h.ce("button",{class:"user__tools-link table__cell",style:"width: 50%; display: inline-block; border-right: 1px solid #cdd4e1; box-sizing: border-box;",html:'<span class="sp_plus_ico_del"></span><span style="color: #F86934;">Удалить выбранные</span>',onclick:function(){var t=0,n=new Array;p.innerHTML='<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">Выбрать все</span>';for(var a=0;a<i.length;a++)if(1==i[a].checked){var l=/^SP_DB_([0-9]+)$/i.exec(i[a].id)[1];n.push(l),i[a].checked=!1,t++}if(t>0){var r=h.declOfNum(t,["","а","ов"]);h.confirmm("Хотите удалить "+t+" блог"+r+"?",function(){var i=setInterval(function(){h.alertm("Удаляем блоги: <span style='color: #008000;'>"+t+"</span><br/><a href='#' onclick='return false;' id='SP_PLUS_CANCEL' class='sp_plus_a'>Отмена</a>",0,null);var a=n[--t];h.ajax(e+"//spaces.ru/diary/delete/?r=diary/delete","POST","CK="+s+"&id="+a+"&Sure=1",function(e){h.console.info("[S+] Блог удален: "+a)},2),h.qs("#SP_PLUS_CANCEL").onclick=function(){n=null,clearInterval(i),h.alertm("Отменено!<br/><a href='"+document.location.href.replace(/\#.*$/i,"")+"' onclick='document.body.removeChild(this.parentNode); return true;' class='sp_plus_a'>Обновить страницу</a>",1,null)},t<1&&(n=null,clearInterval(i),h.alertm("Готово!<br/><a href='"+document.location.href.replace(/\#.*$/i,"")+"' onclick='document.body.removeChild(this.parentNode); return true;' class='sp_plus_a'>Обновить страницу</a>",1,null))},500)})}else h.alertm("Не выбрано ни одного блога!",1,null);return!1}});c.appendChild(d),c.appendChild(p),h.insertAfter(c,o)}else{for(a=0;a<i.length;a++)i[a].style.display="none";c=h.ce("div",{style:"display: none;",id:"SP_PLUS_BOTTOM_DIVB"}),document.body.appendChild(c)}}}catch(e){h.console.error("Ошибка (BLOGS): "+e.name+":"+e.message+"\n"+e.stack)}},prompt:function(e,t){e=e||"",t=t||"";var n=prompt(e,t);return null==n?"":n},icon:function(e){return e?'<span class="sp_plus_ico_info"></span> ':'<span class="sp_plus_ico_alert"></span> '},confirmm:function(e,t){var n=h.ce("a",{html:"Да",href:"#",class:"sp_plus_a",style:"color: #800000"});n.onclick=function(e){return t(),document.body.removeChild(e.target.parentNode),!1};var s=h.qs("#SP_PLUS_CONFIRM");s?s.innerHTML=e+'<br/><br/><a class="sp_plus_a" href="#" style="color: #008000;" onclick="document.body.removeChild(this.parentNode); return false;">Нет</a>&nbsp;&nbsp;':(s=h.ce("div",{class:"sp_plus_alert_y",id:"SP_PLUS_CONFIRM",html:e+'<br/><br/><a class="sp_plus_a" href="#" style="color: #008000;" onclick="document.body.removeChild(this.parentNode); return false;">Нет</a>&nbsp;&nbsp;'}),document.body.appendChild(s)),s.appendChild(n)},alert:function(e,t,n){var s=h.qs("#import_alert_div"),i=t?"oh nl sp_plus_alertg":"oh nl sp_plus_alertr";s.className=i,s.innerHTML=n?"<span class=\"ico ico_remove pointer right\" onclick=\"this.parentNode.className='';this.parentNode.innerHTML='';\"></span>"+e:e},alertm:function(t,n,s){var i=h.qs("#SP_PLUS_ALERT");i?i.innerHTML=(n?'<img src="'+e+'//spac.me/i/cross_r.gif" alt="" class="pointer right notif_close" onclick="document.body.removeChild(this.parentNode);" title="Закрыть" />':"")+t:(i=h.ce("div",{class:"sp_plus_alert_y",id:"SP_PLUS_ALERT",html:(n?'<img src="'+e+'//spac.me/i/cross_r.gif" alt="" class="pointer right notif_close" onclick="document.body.removeChild(this.parentNode);" title="Закрыть" />':"")+t}),document.body.appendChild(i)),s||setTimeout(function(){h.qs("#SP_PLUS_ALERT")&&h.qs("#SP_PLUS_ALERT").parentNode.removeChild(i)},4e3)},alertmenu:function(t,n){var s=h.qs("#SP_PLUS_ALERT");s?s.innerHTML=(n?'<img src="'+e+'//spac.me/i/cross_r.gif" alt="" class="pointer right notif_close" onclick="document.body.removeChild(this.parentNode);" title="Закрыть" />':"")+t:(s=h.ce("div",{class:"sp_plus_alert_y",style:"overflow: scroll;",id:"SP_PLUS_ALERT",html:(n?'<img src="'+e+'//spac.me/i/cross_r.gif" alt="" class="pointer right notif_close" onclick="document.body.removeChild(this.parentNode);" title="Закрыть" />':"")+t}),document.body.appendChild(s))},comments:function(){var e=h.getClassName("span.comment_date",null),t=h.qs("#SP_PLUS_BOTTOM_DIV");try{if(e){if(!t||e.length!=r){r=e.length;var n=null,s=h.qs("div.js-comments-pgn"),i=h.find(document.getElementsByTagName("input"),{name:"del_comment_"});if(i){for(var a=h.find(i[0].parentNode.getElementsByTagName("a"),{innerHTML:"Удалить"}),l=0;l<i.length;l++)if(!i[l].id||!/^DC_\d+$/i.test(i[l].id)){var o=h.ce("label",{attr:{for:"DC_"+i[l].value}});i[l].id="DC_"+i[l].value,i[l].className="sp_plus_checkbox",h.insertAfter(o,i[l])}}else for(var c=0;c<e.length;c++){if((n=h.find(e[c].parentNode.parentNode.getElementsByTagName("a"),{innerHTML:"Удалить"}))&&0==e[c].getElementsByTagName("input").length){var p=h.ce("input",{type:"checkbox",class:"sp_plus_checkbox",id:"DC_"+e[c].parentNode.parentNode.parentNode.id});o=h.ce("label",{attr:{for:"DC_"+e[c].parentNode.parentNode.parentNode.id}}),e[c].appendChild(p),e[c].appendChild(o)}c!=e.length-1||s||(s=e[c].parentNode.parentNode)}if((i&&a||n)&&!t){var d=document.getElementsByTagName("input"),u=h.ce("div",{class:"widgets-group user__tools_last",id:"SP_PLUS_BOTTOM_DIV"}),_=h.ce("button",{class:"user__tools-link table__cell",style:"width: 50%; display: inline-block; box-sizing: border-box;",html:'<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">Выбрать все</span>',onclick:function(e){for(var t="SPAN"==e.target.nodeName?e.target.parentNode:e.target,n=0;n<d.length;n++)"checkbox"==d[n].type&&/DC_([0-9]+)/gi.test(d[n].id)&&"none"!=d[n].parentNode.parentNode.parentNode.style.display&&(t.innerHTML.indexOf("Выбрать все")>=0?d[n].checked=!0:d[n].checked=!1);return t.innerHTML='<span class="sp_plus_ico_okb"></span><span style="color: #57A3EA;">'+(t.innerHTML.indexOf("Выбрать все")>=0?"Снять отметки":"Выбрать все")+"</span>",!1}}),m=h.ce("button",{class:"user__tools-link table__cell",style:"width: 50%; display: inline-block; border-right: 1px solid rgb(205, 212, 225); box-sizing: border-box;",html:'<span class="sp_plus_ico_del"></span><span style="color: #F86934;">Удалить выбранные</span>',onclick:function(){for(var e=0,t=new Array,n=new Array,s=0;s<d.length;s++)if("checkbox"==d[s].type&&/DC_([0-9]+)/gi.test(d[s].id)&&1==d[s].checked){if(i)var a=h.find(d[s].parentNode.parentNode.parentNode.getElementsByTagName("a"),{innerHTML:"Удалить"});else a=h.find(d[s].parentNode.parentNode.parentNode.getElementsByTagName("a"),{innerHTML:"Удалить"});t.push(a[0]),n.push(d[s]),e++}if(e>0){var l=h.declOfNum(e,["й","я","ев"]);h.confirmm("Хотите удалить "+e+" комментари"+l+"?"+(f.comments_m2?" (альтернативный способ)":""),function(){var s=setInterval(function(){if(h.alertm("Удаляем комментарии: <span style='color: #008000;'>"+e+"</span><br/><a href='#' onclick='return false;' id='SP_PLUS_CANCEL' class='sp_plus_a'>Отмена</a>",0,null),e--,f.comments_m2&&t[e].href)h.ajax(t[e].href,"GET",null,null,2);else{var i=document.createEvent("MouseEvent");i.initEvent("click",!0,!0),t[e].dispatchEvent(i)}n[e].checked=!1,n[e].className+=" sp_plus_ch_cd",h.qs("#SP_PLUS_CANCEL").onclick=function(){t=null,n=null,clearInterval(s),f.comments_m2?h.setLocation(document.location.href.replace(/\#.*$/i,"")):h.alertm("Отменено!<br/><a href='"+document.location.href.replace(/\#.*$/i,"")+"' onclick='document.body.removeChild(this.parentNode); return true;' class='sp_plus_a'>Обновить страницу</a>",1,null)},e<1&&(t=null,n=null,clearInterval(s),f.comments_m2?h.setLocation(document.location.href.replace(/\#.*$/i,"")):h.alertm("Готово!<br/><a href='"+document.location.href.replace(/\#.*$/i,"")+"' onclick='document.body.removeChild(this.parentNode); return true;' class='sp_plus_a'>Обновить страницу</a>",1,null))},500)})}else h.alertm("Не выбрано ни одного комментария!",1,null);return!1}});u.appendChild(m),u.appendChild(_),s?h.insertAfter(u,s):h.qs("#page-down")?h.inBefore(u,h.qs("#page-down")):h.console.error("[S+] Не смогли найти ориентир для вставки!")}}}else r=0}catch(e){h.console.error("Ошибка (COMMENTS): "+e.name+":"+e.message+"\n"+e.stack)}},playerDown:function(){var e=h.qs("#SP_MUSIC_DOWN");try{var t=0,n=sessionStorage.getItem("music:track"),s=sessionStorage.getItem("music:playlist"),i=h.qs("#gp_main_player");if(i&&n&&s){var a=JSON.parse(n);t=parseInt(a.id,10);var l=JSON.parse(s).playlist.playlist[t].src,r=h.find(i.getElementsByTagName("td"),{className:"ico_td"});if(r&&!e){p=t;var o=h.ce("td",{id:"SP_MUSIC_DOWN",class:"ico_td",innerHTML:'<a href="'+l+'" target="_blank" class="tdn"></span><span class="ico ico_download2" title="Скачать"></span></a>'});h.insertAfter(o,r[0])}else e&&p!=t&&(p=t,h.console.info("[S+] Обновили трек!"),e.innerHTML='<a href="'+l+'" target="_blank" class="tdn"></span><span class="ico ico_download2" title="Скачать"></span></a>')}}catch(t){e&&h.remove(e),h.console.error("Ошибка (PLAYER_DOWN): "+t.name+":"+t.message+"\n"+t.stack)}},coins:function(){var t=h.find(document.links,{href:e+"//spaces.ru/services/gift_get/?id="});t&&(t=t[0],h.ajax(t.href,"GET",null,function(){try{t&&(h.remove(t),h.console.info("[S+] Собрали монеты"))}catch(e){h.console.info("[S+] Собрали монеты???")}},2))},redirectURL:function(){var t=h.getClassName("a.c-red"),n=h.find(document.links,{href:e+"//spaces.ru/redirect/?"});n&&t&&(n=n[0],h.remove(n),window.open(n,"_blank")||alert("Разрешите всплывающие окна для Spaces.ru"),h.setLocation(t))},blogTools:function(){if("/diary/read/"==document.location.pathname.toString()&&!h.qs("#SP_PLUS_DELETEBL"))try{var t=h.find(document.links,{href:e+"//spaces.ru/diary/new/?"});if(t||(t=h.find(document.links,{href:e+"//spaces.ru/diary/share/index/?"}))&&!/(\?|&)Topic_id=([0-9]+)/i.test(t[0].href)&&(t=null),t)for(var n=0;n<t.length;n++)if(t[n].className){t=t[n];break}var s=h.getQuery("id")||h.getQuery("Topic_id");if(t&&s){var i=h.getQuery("address"),a=e+"//spaces.ru/diary/view/?";i&&h.jajax(document.location.href,function(e){try{if(e){var t=h.extend({topicWidget:{topicModels:{topic_id:null}}},JSON.parse(e));t.topicWidget.topicModel.owner_id&&(a+="comm="+t.topicWidget.topicModel.owner_id,h.console.info("[S+] Редирект: "+a))}}catch(e){h.console.error("Ошибка (JSON_BLOGTOOLS_COMM): "+e.name+":"+e.message+"\n"+e.stack)}});var l=h.getCK(0);if("TD"==t.parentNode.nodeName){var r=h.ce("td",{class:t.parentNode.className}),o=h.ce("a",{href:e+"//spaces.ru/diary/delete/?id="+s+"&irb526786=1",html:'<img src="'+e+'//spac.me/i/remove.png" alt="" class="p16 m">',id:"SP_PLUS_DELETEBL",title:"Удалить запись",class:t.className,onclick:function(){var t=h.getClassName("div.blog-item__title",null);return t=t?' <b style="color: #0000FF">'+t[0].innerHTML+"</b>":"",h.confirmm("Хотите удалить запись"+t+"?",function(){h.ajax(e+"//spaces.ru/diary/delete/","POST","CK="+l+"&Sure=1&id="+s,function(e){h.setLocation(a)},2)}),!1}});h.inBefore(r,t.parentNode),r.appendChild(o)}else o=h.ce("a",{href:e+"//spaces.ru/diary/delete/?id="+s+"&irb526786=1",html:'<img src="'+e+'//spac.me/i/remove.png" alt="" class="p16 m"> <span class="m">Удалить</span>',id:"SP_PLUS_DELETEBL",title:"Удалить запись",class:t.className,onclick:function(){var t=h.getClassName("div.blog-item__title",null);return t=t?' <b style="color: #0000FF">'+t[0].innerHTML+"</b>":"",h.confirmm("Хотите удалить запись"+t+"?",function(){h.ajax(e+"//spaces.ru/diary/delete/","POST","CK="+l+"&Sure=1&id="+s,function(e){h.setLocation(a)},2)}),!1}}),h.inBefore(o,t),"BR"==t.nextElementSibling.nodeName&&h.insertAfter(h.ce("br",null),o)}}catch(e){h.console.error("Ошибка (BLOGTOOLS): "+e.name+":"+e.message+"\n"+e.stack)}},setStyle:function(){var t=h.service(1)||"777",n=document.getElementsByTagName("head").item(0),s=h.qs("#SP_PLUS_INJSTYLE")||h.ce("style",{id:"SP_PLUS_INJSTYLE",type:"text/css"});s.innerHTML=".sp_plus_alert_y{-webkit-box-shadow:#888 0 5px 90px 0;border:1px solid #e2b709;border-radius:5px;box-shadow:#888 0 5px 90px 0;color:#404040;display:block;font-family:sans-serif;font-weight:700;height:auto;padding:17px;position:fixed;text-align:center;margin-left:-156px;top:10%;left:50%;max-height:80%;width:275px;z-index:11000;background:#ffe57e;}.sp_plus_alertg,.sp_plus_small{background-color:#ddebf7}.sp_plus_small{margin:2px;color:#000;display:block;padding:3px;border-radius:2px}.sp_plus_small img{height:auto!important}.sp_plus_a{color:#006090;text-decoration:none!important;border-bottom:1px dashed}.sp_plus_alertr{background-color:#f9e1d9;color:#ff6837}.sp_plus_alertg,.sp_plus_alertr{background-clip:border-box;background-image:none;background-origin:padding-box;box-shadow:rgba(57,83,135,.3) 0 3px 5px 0;display:block;padding:10px;position:relative;font-size:13px}.sp_plus_ico_alert,.sp_plus_ico_del,.sp_plus_ico_info,.sp_plus_ico_okb,.sp_plus_ico_fav_off,.sp_plus_ico_fav_on{background-color:transparent;background-image:url("+e+"//spac.me/i/ico.png?r="+t+");cursor:pointer;display:inline-block;height:16px;margin-bottom:2px;margin-right:4px;vertical-align:middle;text-align:center;width:16px}.sp_plus_ico_del{background-position:-180px -256px}.sp_plus_ico_okb{background-position:-116px -198px}.sp_plus_ico_alert{background-position:-108px -364px;cursor:default}.sp_plus_ico_info{background-position:-142px -52px;cursor:default}.sp_plus_ico_fav_off{background-position:-216px -256px}.sp_plus_ico_fav_on{background-position:-252px -256px}.sp_plus_button{cursor:pointer;background:#fff}.sp_plus_button:hover{background:#ecf5fd}.sp_plus_checkbox+label,.sp_plus_checkbox_el+label{position:relative;overflow:hidden;cursor:pointer;text-decoration:none!important}.sp_plus_checkbox+label{margin-left:5px;padding:0 4px 0 4px;vertical-align:top;width:16px;height:16px;display:inline-block}.sp_plus_checkbox_el+label{color:grey;padding:12px 5px 12px 25px}.sp_plus_checkbox+label:before,.sp_plus_checkbox_el+label:before{position:absolute;display:inline-block;content:'';background-position:-72px -220px;width:16px;height:16px;background-color:transparent;background-image:url("+e+"//spac.me/i/ico.png?r="+t+")}.sp_plus_checkbox_el+label:before{left:3px;top:12px}.sp_plus_checkbox+label:before{top:8px;margin-top:-8px}.sp_plus_checkbox_el:checked+label{color:#323232}.sp_plus_checkbox:checked+label:before,.sp_plus_checkbox_el:checked+label:before{background-position:-252px -108px}.sp_plus_checkbox,.sp_plus_checkbox_el{position:absolute;left:-10000px}",f.bodystyle&&(f.bodystyle.url&&f.bodystyle.urlchecked&&(s.innerHTML+="body,#main_wrap{background-image:url("+f.bodystyle.url+")}"),f.bodystyle.color&&f.bodystyle.colorchecked&&(s.innerHTML+="body,#main_wrap{background-color:"+f.bodystyle.color+"}")),n.appendChild(s)},start:function(){if(f.blocked&&h.bannedTools(),f.comments&&h.comments(),f.blogsd&&h.blogsDelete(),f.readersd&&h.readersDelete(),f.online&&h.online(),f.favorite&&h.favorite(),f.friendsOn&&h.friendsOnline(1),f.gifts&&h.gifts(),f.rscroll&&h.scrollMove(1),f.hrightbar&&h.hiddenRightbar(1),f.coins&&h.coins(),f.rurl&&h.redirectURL(),f.fileTools&&h.blogTools(),f.myEvents&&h.events(),f.isOnline&&h.isOnlineSupport(0),f.playerdn)h.playerDown();else if(!f.playerdn&&p>=0){p=-1;var e=h.qs("#SP_MUSIC_DOWN");e&&h.remove(e)}h.settings()},init:function(){h.readSettings(),h.start(),setInterval(function(){h.start()},100),h.setStyle()}}).init()}();
